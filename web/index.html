<!DOCTYPE html>
<html>
<head>
<title>Start Page</title>
<link rel="shortcut icon" href="./pics/favicon.svg" type="image/svg+xml" />
<link rel="stylesheet" href="./style.css" type="text/css" media="screen" />
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1">
</head>
<body style="background-color:#893531 ">
	<div class="status-bar">
		<p id="sun_moon" style="display: inline-block;">Sunrise Sunset Moonphase</p>
		<a id="coins" href="https://rate.sx/" target="_blank" style="float: right; display: inline-block; margin: 10px; text-decoration: none; color: beige">Coins</a>
		<!--		<p id="coins" style="float: right; display: inline-block;">Currency</p> -->
		<select name="fiat_select" id="fiat_select" style="float: right; display: inline-block;">
			<option value="usd">$</option>
			<option value="eur">â‚¬</option>
			<option value="czk">KÄ</option>
			<option value="btc">BTC</option>
		</select>

	</div>
	<hr style="color: beige">
	<nav id="nav">
		<ul>
			<li><a href="./forecast.html">ğŸŒ§ï¸ğŸ“…</a></li>
		</ul>
	</nav>

	<main  style="margin-top: 20px;">
		<p id="curr">ğŸ’µCurrency</p>
		<div id="text_forecast">
			<p id="tomorrow_forecast" style="display: inline-block">Text Forecast</p>
			<p id="next_forecast" style="display: inline-block">Text Forecast</p>
		</div>
		<div id="english">
			<h4 style="display:inline-block">English</h4>
			<form action="https://slovniky.lingea.cz/anglicko-cesky/" autocomplete="off" method="get" style="display:inline-block">
				<input id="topic" name="word" type="text" maxlength="50" autocomplete="off">
				<button type="submit" id="submit">Search</button>
			</form>
		</div>
		<div id="deutsch">
			<h4 style="display: inline-block">Deutsch</h4>
			<form action="https://slovniky.lingea.cz/nemecko-cesky/" autocomplete="off" method="get" style="display:inline-block">
				<input id="topic" name="word" type="text" maxlength="50" autocomplete="off">
				<button type="submit" id="submit">Search</button>
			</form>
		</div>
		<div id="wttr-in-module">
		<!-- https://wttr.in/_0pq_transparency=240_background=442244_lang=en.png -->
			<a href='https://wttr.in/' target="_blank" target='sat24'><image id="weather-img" src='' loading=lazy alt="Current weather in"></a>
			<form id="weather-form">
				<input id="weather-input" class="form-control" type="text" placeholder="Weather in..." aria-label="Weather in...">
				<button id="weather-btn" type="button">Search</button>
			</form>
		</div>
		<!-- https://api.sat24.com/crop?type=rainTMC&lat=50.2334&lon=14.7313&width=600&height=437&zoom=1.00&continent=eu-->
		<!-- https://api.sat24.com/crop?type=rainTMC&lat=50.2334&lon=14.7313&width=360&height=227&zoom=1.00&continent=eu-->
		<!-- rain -->
		<a href='https://api.sat24.com/animated/DE/rainTMC/3/Central%20Europe%20Standard%20Time/5603172' target='sat24' id="link_sat24"><image src='https://api.sat24.com/mostrecent/DE/rainTMC' id="img_sat24" width=360 height=227 loading=lazy style="margin: 5px"></a>
		<!-- sun and clouds -->
		<a href='https://api.sat24.com/animated/DE/visual/3/Central%20Europe%20Standard%20Time/530005' target='sat24'><img src='https://api.sat24.com/mostrecent/DE/visual5hdcomplete' width=360 height=227 style="margin: 5px"></a>
		<br>
		<details style="margin-top: 30px">
			<summary>âš™ï¸/ğŸ”§</summary>
			<br>
			<input id="location_input" type="text" placeholder="Location..." aria-label="Location...">

			<input id="linksat24_input" type="text" placeholder="Sat24 link..." aria-label="Sat24 link...">

			<select name="lang" id="select_lang">
				<option value="en-US">US</option>
				<option value="de-DE">DE</option>
				<option value="cs-CZ">CZ</option>
			</select>

			<button id="save_btn" type="button">Save</button>
		</details>

		<script async="" src="./js/module-wttrin-widget.js"></script>
		<script>
//
//			preferences
//
			var fiatSelect = document.getElementById("fiat_select")
			var coinCode = fiatSelect.value
			var place = ""
			var defaultLinkSat24 = "https://api.sat24.com/mostrecent/DE/rainTMC"
			var linkSat24 = document.getElementById("link_sat24") 
			var formatSelect = document.getElementById("select_lang")

			var date = new Date(Date.now())
			date.setFullYear(date.getFullYear()+1)
			if (document.cookie.length != 0) {
				var cookieList = document.cookie.split("; ")
				var cookieCoinCode = cookieList.find(e => e.startsWith("coin_code"))
				if (cookieCoinCode != undefined) {
					coinCode = cookieCoinCode.split("=")[1]
					fiatSelect.value = coinCode
				} else {
					document.cookie = "coin_code="+fiatSelect.value+"; expires="+date.toUTCString()+"; Path=/; SameSite=None; Secure" 
					coinCode = fiatSelect.value

				}

				var cookiePlace = cookieList.find(e => e.startsWith("place"))
				if (cookiePlace != undefined) {
					place = cookiePlace.split("=")[1]
					var inputLocation = document.getElementById("location_input")
					inputLocation.value = place
				} else {
					document.cookie = "place="+place+"; expires="+date.toUTCString()+"; Path=/; SameSite=None; Secure" 
				}

				var inputLink = document.getElementById("linksat24_input")
				var cookieLinkSat24 = cookieList.find(e => e.startsWith("link_sat24"))
				if (cookieLinkSat24 != undefined) {
					link = cookieLinkSat24.split("link_sat24=")[1]
					var img = document.getElementById("img_sat24")
					linkSat24.href = link
					img.src = link
					inputLink.value = link

				} else {
					document.cookie = "link_sat24="+linkSat24.href+"; expires="+date.toUTCString()+"; Path=/; SameSite=None; Secure"
					inputLink.value = linkSat24.href
				}
				var cookieLang = cookieList.find(e => e.startsWith("lang"))
				if (cookieLang != undefined) {
					lang = cookieLang.split("=")[1]
					formatSelect.value = lang
				} else {
					document.cookie = "lang="+formatSelect.value+"; expires="+date.toUTCString()+"; Path=/; SameSite=None; Secure"

				}

			} else {
				document.cookie = "coin_code="+fiatSelect.value+"; expires="+date.toUTCString()+"; Path=/; SameSite=None; Secure" 
				document.cookie = "place="+place+"; expires="+date.toUTCString()+"; Path=/; SameSite=None; Secure" 
				document.cookie = "link_sat24="+linkSat24.href+"; expires="+date.toUTCString()+"; Path=/; SameSite=None; Secure"
				document.cookie = "lang="+formatSelect.value+"; expires="+date.toUTCString()+"; Path=/; SameSite=None; Secure"
			}
			var weatherImg = document.getElementById("weather-img")
			weatherImg.src =  "https://wttr.in/"+place+"_0pq_transparency=240_background=442244_lang=en.png"

			document.getElementById("save_btn").onclick = function () {
				var date = new Date(Date.now())
				date.setFullYear(date.getFullYear()+1)
				var inputLocation = document.getElementById("location_input")	
				if (inputLocation.value != ""){
					place = encodeURIComponent(inputLocation.value)
					document.cookie = "place="+inputLocation.value+"; expires="+date.toUTCString()+"; Path=/; SameSite=None; Secure"
					var weatherImg = document.getElementById("weather-img")
					weatherImg.src =  "https://wttr.in/"+place+"_0pq_transparency=240_background=442244_lang=en.png"
				}

				var inputLink = document.getElementById("linksat24_input")
				var img = document.getElementById("img_sat24")
				img.src = inputLink.value
				if (inputLink.value != "") {
					linkSat24.href = inputLink.value
					document.cookie = "link_sat24="+inputLink.value+"; expires="+date.toUTCString()+"; Path=/; SameSite=None; Secure"
				} else {
					linkSat24.href = defaultLinkSat24 
					document.cookie = "link_sat24="+defaultLinkSat24+"; expires="+date.toUTCString()+"; Path=/; SameSite=None; Secure"

				}
				
			}
//
//			base init
//
			const options = {
				method: "POST",
				headers: {
					"Content-Type": "application/json"
				},
				body: JSON.stringify({
					"coin_code": fiatSelect.value,
					"location": place
				})
			}
			fetch("/base_info", options).then(res => res.json())
				.then(res => {
				resList = res.weather.sun_moon.split(" ")
				var sun_moon = document.getElementById("sun_moon")	
				sun_moon.innerHTML = "ğŸŒ… "+resList[0]+"  ğŸŒ‡"+resList[1]+"  "+resList[2]+
						     "  "+res.weather.hum_low_high[0]
				const date = new Date(Date.now())
				date.setDate(date.getDate()+1)
				var formatSelect = document.getElementById("select_lang")
				var tomorrow_forecast = document.getElementById("tomorrow_forecast")
				date_output = new Intl.DateTimeFormat(formatSelect.value, {weekday: "long", day:"numeric", month:"long"}).format(date)
				tomorrow_forecast.innerHTML = date_output+": "+res.weather.hum_low_high[1]

				var next_forecast = document.getElementById("next_forecast")
				date.setDate(date.getDate()+1)
				date_output = new Intl.DateTimeFormat(formatSelect.value, {weekday: "long", day:"numeric", month:"long"}).format(date)
				next_forecast.innerHTML = date_output+": "+res.weather.hum_low_high[2]

//
//				COINS
//
				var fiatSelect = document.getElementById("fiat_select")
				fiatSymbol = { "usd": "$", "eur": "â‚¬", "czk": "KÄ" }
				var coins = document.getElementById("coins")			
				var btc = parseFloat(res.coins.btc)
				var xmr = parseFloat(res.coins.xmr)
				coins.innerHTML = "<img src=\"./pics/bitcoin-icon.svg\"> "+btc.toFixed(2)+fiatSymbol[res.coins.coin_code]+"  "+
						 "<img src=\"./pics/monero-icon.svg\"> "+xmr.toFixed(2)+fiatSymbol[res.coins.coin_code]
//
//				FIAT CURRENCY
//
				var curr = document.getElementById("curr")
				var currPrices = res.currs
				var usd_index = currPrices.code.indexOf("USD")
				currPrices.value[usd_index] = currPrices.value[usd_index].replace(",", ".")
				var usd = parseFloat(currPrices.value[usd_index])
				var eur_index = currPrices.code.indexOf("EUR")
				currPrices.value[eur_index] = currPrices.value[eur_index].replace(",", ".")
				var eur = parseFloat(currPrices.value[eur_index])

				var gbp_index = currPrices.code.indexOf("GBP")
				currPrices.value[gbp_index] = currPrices.value[gbp_index].replace(",", ".")
				var gbp = parseFloat(currPrices.value[gbp_index])
				
				curr.innerHTML = "ğŸ’µ "+currPrices.volume[usd_index]+"$  "+usd.toFixed(2)+"KÄ  "+currPrices.volume[eur_index]+"â‚¬  "+eur.toFixed(2)+"KÄ  "+currPrices.volume[gbp_index]+"Â£  "+gbp.toFixed(2)+"KÄ"
				
				
			})

			formatSelect.onchange = function() {
				document.cookie = "lang="+formatSelect.value+"; expires="+date.toUTCString()+"; Path=/; SameSite=None; Secure"
			}

			fiatSelect.onchange = function() {
				const options = {
					method: "POST",
					headers: {
						"Content-Type": "application/json"
					},
					body: JSON.stringify({
						"coin_code": this.value,
						"param": "conversion"
					})
				}
				
				var date = new Date(Date.now())
				date.setFullYear(date.getFullYear()+1)
				document.cookie = "coin_code="+this.value+"; Path=/; SameSite: None; Secure"
				fetch("/base_info", options).then(res => res.json())
					.then(res => {
					fiatSymbol = { "usd": "$", "eur": "â‚¬", "czk": "KÄ", "btc": "<img src=\"./pics/bitcoin-icon.svg\">" }
					var coins = document.getElementById("coins")			

					var countdecimals = 2
					coinPrices = res
					var btc = parseFloat(coinPrices.btc)
					var xmr = parseFloat(coinPrices.xmr)

					if (coinPrices.coin_code == "btc") {
						 countdecimals = 6
					}
					coins.innerHTML = "<img src=\"./pics/bitcoin-icon.svg\"> "+btc.toFixed(countdecimals)+fiatSymbol[coinPrices.coin_code]+"  "+
							 "<img src=\"./pics/monero-icon.svg\"> "+xmr.toFixed(countdecimals)+fiatSymbol[coinPrices.coin_code]
				})
			}

		</script>

	</main>
	<footer >
		<p style="float:left"> <a href="https://github.com/Solamil/merlot"><img src="./pics/git-icon.svg"></a></p>
		<p id="donateLink" style="float: right"><a href="https://donate.michalkukla.xyz/" style="color: beige; text-decoration: none">ğŸ’¸</a></p>
		<p style="float: right"><a href="https://michalkukla.xyz/" style="color: beige; text-decoration: none">Author</a></p>
	</footer>
</body>
</html>
